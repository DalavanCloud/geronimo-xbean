<?xml version="1.0" encoding="UTF-8" ?>
<!--
* Copyright 2005 the original author or authors.
*
*  Licensed under the Apache License, Version 2.0 (the "License");
*  you may not use this file except in compliance with the License.
*  You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
*  Unless required by applicable law or agreed to in writing, software
*  distributed under the License is distributed on an "AS IS" BASIS,
*  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
*  See the License for the specific language governing permissions and
*  limitations under the License.
-->
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
    <bean name="JMXBridge" class="org.gbean.jmx.JMXBridge">
        <constructor-arg index="0"><bean class="org.gbean.spring.KernelReference"/></constructor-arg>
        <constructor-arg index="1"><ref bean=":j2eeType=ServiceInvokerManager,name=default"/></constructor-arg>
    </bean>

    <bean name="ServerInfo" class="org.apache.geronimo.system.serverinfo.ServerInfo">
        <constructor-arg><null/></constructor-arg>
    </bean>

    <bean name="URLFactory" class="org.apache.geronimo.system.url.GeronimoURLFactory"/>

    <bean name="LocalConfigurationStore" class="org.apache.geronimo.system.configuration.LocalConfigStore">
        <property name="gbean-objectName"><value>geronimo.server:J2EEApplication=null,J2EEModule=org/apache/geronimo/System,J2EEServer=geronimo,j2eeType=ConfigurationStore,name=Local</value></property>
        <constructor-arg index="0"><bean class="org.gbean.geronimo.GeronimoKernelReference"/></constructor-arg>
        <constructor-arg index="1"><bean class="org.gbean.spring.ObjectNameStringReference"/></constructor-arg>
        <constructor-arg index="2"><value>config-store</value></constructor-arg>
        <constructor-arg index="3"><ref bean="ServerInfo"/></constructor-arg>
    </bean>

    <bean name="ConfigurationManager" class="org.apache.geronimo.kernel.config.ConfigurationManagerImpl">
        <property name="gbean-objectName"><value>:j2eeType=ConfigurationManager,name=ConfigurationManager</value></property>
        <constructor-arg index="0"><bean class="org.gbean.geronimo.GeronimoKernelReference"/></constructor-arg>
        <constructor-arg index="1">
            <bean class="org.gbean.spring.LiveProxyHashSetReference">
                <property name="name"><value>Stores</value></property>
                <property name="pattern"><value>*:j2eeType=ConfigurationStore,*</value></property>
                <property name="type"><value>org.apache.geronimo.kernel.config.ConfigurationStore</value></property>
            </bean>
        </constructor-arg>
    </bean>

    <bean name="FileConfigurationList" class="org.apache.geronimo.system.configuration.FileConfigurationList">
        <constructor-arg index="0"><bean class="org.gbean.geronimo.GeronimoKernelReference"/></constructor-arg>
        <constructor-arg index="1"><ref bean="ServerInfo"/></constructor-arg>
        <constructor-arg index="2"><ref bean="ConfigurationManager"/></constructor-arg>
        <constructor-arg index="3"><value>var/config/config.list</value></constructor-arg>
    </bean>

    <bean name="Repository" class="org.apache.geronimo.system.repository.ReadOnlyRepository">
        <constructor-arg index="0"><value>repository/</value></constructor-arg>
        <constructor-arg index="1"><ref bean="ServerInfo"/></constructor-arg>
    </bean>

    <bean name="RMIRegistry" class="org.apache.geronimo.system.rmi.RMIRegistryService">
        <property name="port"><value>1099</value></property>
    </bean>

    <bean name="NamingProperties" class="org.apache.geronimo.system.properties.NamingProperties">
        <constructor-arg index="0"><value>com.sun.jndi.rmi.registry.RegistryContextFactory</value></constructor-arg>
        <constructor-arg index="1"><value>org.apache.geronimo.naming</value></constructor-arg>
        <constructor-arg index="2"><value>rmi://localhost:1099</value></constructor-arg>
    </bean>

    <bean name="properties-login" class="org.apache.geronimo.security.jaas.LoginModuleGBean">
        <property name="gbean-objectName"><value>:j2eeType=LoginModule,name=properties-login</value></property>
        <constructor-arg index="0"><value>org.apache.geronimo.security.realm.providers.PropertiesFileLoginModule</value></constructor-arg>
        <constructor-arg index="1"><bean class="org.gbean.spring.ObjectNameStringReference"/></constructor-arg>
        <constructor-arg index="2"><value>true</value></constructor-arg>
        <property name="options">
            <props>
                <prop key="usersURI">var/security/users.properties</prop>
                <prop key="groupsURI">var/security/groups.properties</prop>
            </props>
        </property>
        <property name="loginDomainName"><value>geronimo-properties-realm</value></property>
    </bean>

    <bean name="geronimo-properties-realm" class="org.apache.geronimo.security.realm.GenericSecurityRealm">
        <property name="gbean-objectName"><value>:j2eeType=SecurityRealm,name=geronimo-properties-realm</value></property>
        <constructor-arg index="0"><value>geronimo-properties-realm</value></constructor-arg>
        <constructor-arg index="1"><ref bean="properties-login-options"/></constructor-arg>
        <constructor-arg index="2"><value>false</value></constructor-arg>
        <constructor-arg index="3"><null/></constructor-arg>
        <constructor-arg index="4"><ref bean="ServerInfo"/></constructor-arg>
        <constructor-arg index="5"><bean class="org.gbean.spring.ClassLoaderReference"/></constructor-arg>
        <constructor-arg index="6"><bean class="org.gbean.geronimo.GeronimoKernelReference"/></constructor-arg>
    </bean>

    <bean name="properties-login-options" class="org.apache.geronimo.security.jaas.JaasLoginModuleUse">
        <property name="gbean-objectName"><value>:j2eeType=LoginModuleUse,name=properties-login-options</value></property>
        <constructor-arg index="0"><ref bean="properties-login"/></constructor-arg>
        <constructor-arg index="1"><null/></constructor-arg>
        <constructor-arg index="2"><value>REQUIRED</value></constructor-arg>
     </bean>

    <bean name="JMX" class="org.apache.geronimo.security.jaas.ServerRealmConfigurationEntry">
        <property name="gbean-objectName"><value>:j2eeType=ConfigurationEntry,name=JMX</value></property>
        <constructor-arg index="0"><value>JMX</value></constructor-arg>
        <constructor-arg index="1"><value>geronimo-properties-realm</value></constructor-arg>
        <constructor-arg index="2"><bean class="org.gbean.geronimo.GeronimoKernelReference"/></constructor-arg>
    </bean>

    <bean name="LoginConfiguration" class="org.apache.geronimo.security.jaas.GeronimoLoginConfiguration">
        <property name="configurations">
            <bean class="org.gbean.geronimo.CollectionReference">
                <property name="name"><value>Configurations</value></property>
                <property name="patterns">
                    <set>
                        <value type="javax.management.ObjectName">*:j2eeType=SecurityRealm,*</value>
                        <value type="javax.management.ObjectName">*:j2eeType=ConfigurationEntry,*</value>
                    </set>
                </property>
                <property name="type"><value>org.apache.geronimo.security.jaas.ConfigurationEntryFactory</value></property>
            </bean>
        </property>
    </bean>

    <bean name="SecurityService" class="org.apache.geronimo.security.SecurityServiceImpl">
        <constructor-arg index="0"><bean class="org.gbean.spring.ClassLoaderReference"/></constructor-arg>
        <constructor-arg index="1"><ref bean="ServerInfo"/></constructor-arg>
        <constructor-arg index="2"><value>org.apache.geronimo.security.jacc.GeronimoPolicyConfigurationFactory</value></constructor-arg>
        <constructor-arg index="3"><value>org.apache.geronimo.security.jacc.GeronimoPolicy</value></constructor-arg>
        <constructor-arg index="4"><null/></constructor-arg>
        <constructor-arg index="5"><null/></constructor-arg>
        <constructor-arg index="6"><null/></constructor-arg>
        <constructor-arg index="7"><null/></constructor-arg>
    </bean>

    <bean name="JaasLoginService" class="org.apache.geronimo.security.jaas.JaasLoginService">
        <property name="gbean-objectName"><value>geronimo.server:J2EEApplication=null,J2EEModule=org/apache/geronimo/Server,J2EEServer=geronimo,j2eeType=GBean,name=JaasLoginService</value></property>
        <constructor-arg index="0"><value>HmacSHA1</value></constructor-arg>
        <constructor-arg index="1"><value>secret</value></constructor-arg>
        <constructor-arg index="2"><bean class="org.gbean.spring.ClassLoaderReference"/></constructor-arg>
        <property name="realms">
            <bean class="org.gbean.geronimo.CollectionReference">
                <property name="name"><value>realms</value></property>
                <property name="pattern"><value>*:j2eeType=SecurityRealm,*</value></property>
                <property name="type"><value>org.apache.geronimo.security.realm.SecurityRealm</value></property>
            </bean>
        </property>
    </bean>

    <bean name="DefaultThreadPool" class="org.apache.geronimo.pool.ThreadPool">
        <constructor-arg index="0"><value>10</value></constructor-arg>
        <constructor-arg index="1"><value>DefaultThreadPool</value></constructor-arg>
        <constructor-arg index="2"><value>5000</value></constructor-arg>
        <constructor-arg index="3"><bean class="org.gbean.spring.ClassLoaderReference"/></constructor-arg>
    </bean>

    <bean name="ConnectionTracker" class="org.apache.geronimo.connector.outbound.connectiontracking.ConnectionTrackingCoordinator"/>

    <bean name="DefaultWorkManager" class="org.apache.geronimo.connector.work.GeronimoWorkManager">
        <constructor-arg index="0"><value>10</value></constructor-arg>
        <constructor-arg index="1"><value>10</value></constructor-arg>
        <constructor-arg index="2"><value>10</value></constructor-arg>
        <constructor-arg index="3"><ref bean="TransactionContextManager"/></constructor-arg>
    </bean>

    <bean name="HOWLTransactionLog" class="org.apache.geronimo.transaction.log.HOWLLog">
        <constructor-arg index="0"><value>org.objectweb.howl.log.BlockLogBuffer</value></constructor-arg>
        <constructor-arg index="1"><value>32</value></constructor-arg>
        <constructor-arg index="2"><value>true</value></constructor-arg>
        <constructor-arg index="3"><value>50</value></constructor-arg>
        <constructor-arg index="4"><value>var/txlog</value></constructor-arg>
        <constructor-arg index="5"><value>log</value></constructor-arg>
        <constructor-arg index="6"><value>howl</value></constructor-arg>
        <constructor-arg index="7"><value>-1</value></constructor-arg>
        <constructor-arg index="8"><value>0</value></constructor-arg>
        <constructor-arg index="9"><value>2</value></constructor-arg>
        <constructor-arg index="10"><value>4</value></constructor-arg>
        <constructor-arg index="11"><value>-1</value></constructor-arg>
        <constructor-arg index="12"><null/></constructor-arg>
        <constructor-arg index="13"><ref bean="ServerInfo"/></constructor-arg>
    </bean>

    <bean name="TransactionManager" class="org.apache.geronimo.transaction.manager.TransactionManagerImpl">
        <constructor-arg index="0"><value>600</value></constructor-arg>
        <constructor-arg index="1"><ref bean="HOWLTransactionLog"/></constructor-arg>
        <constructor-arg index="2">
            <bean class="org.gbean.geronimo.CollectionReference">
                <property name="name"><value>ResourceManagers</value></property>
                <property name="patterns">
                    <set>
                        <value type="javax.management.ObjectName">*:j2eeType=JCAManagedConnectionFactory,*</value>
                        <value type="javax.management.ObjectName">*:j2eeType=ActivationSpec,*</value>
                    </set>
                </property>
                <property name="type"><value>org.apache.geronimo.transaction.manager.ResourceManager</value></property>
            </bean>
        </constructor-arg>
    </bean>

    <bean name="TransactionContextManager" class="org.apache.geronimo.transaction.context.TransactionContextManager">
        <constructor-arg index="0"><ref bean="TransactionManager"/></constructor-arg>
        <constructor-arg index="1"><ref bean="TransactionManager"/></constructor-arg>
    </bean>

    <bean name="JettyWebContainer" class="org.apache.geronimo.jetty.JettyContainerImpl"/>

    <bean name="JettyRequestLog" class="org.apache.geronimo.jetty.requestlog.NCSARequestLog">
        <constructor-arg index="0"><ref bean="JettyWebContainer"/></constructor-arg>
        <constructor-arg index="1"><ref bean="ServerInfo"/></constructor-arg>

        <property name="filename"><value>var/log/jetty_yyyy_mm_dd.log</value></property>
        <property name="logDateFormat"><value>dd/MMM/yyyy:HH:mm:ss ZZZ</value></property>
        <property name="logTimeZone"><value>GMT</value></property>
    </bean>

    <bean name="JettyWebConnector" class="org.apache.geronimo.jetty.connector.HTTPConnector">
        <constructor-arg index="0"><ref bean="JettyWebContainer"/></constructor-arg>
        <property name="port"><value>8080</value></property>
    </bean>

    <bean name="JettySSLConnector" class="org.apache.geronimo.jetty.connector.HTTPSConnector">
        <constructor-arg index="0"><ref bean="JettyWebContainer"/></constructor-arg>
        <constructor-arg index="1"><ref bean="ServerInfo"/></constructor-arg>

        <property name="port"><value>8443</value></property>
        <property name="keystore"><value>var/security/keystore</value></property>
        <property name="keystoreType"><value>JKS</value></property>
        <property name="password"><value>secret</value></property>
        <property name="keyPassword"><value>secret</value></property>
        <property name="needClientAuth"><value>false</value></property>
        <property name="protocol"><value>TLS</value></property>
    </bean>

    <bean name="EjbNetworkService" class="org.openejb.server.StandardServiceStack">
        <constructor-arg index="0"><value>EJB</value></constructor-arg>
        <constructor-arg index="1"><value>4201</value></constructor-arg>
        <constructor-arg index="2"><value>127.0.0.1</value></constructor-arg>
        <constructor-arg index="3"><value>127.0.0.1</value></constructor-arg>
        <constructor-arg index="4"><value>HOST,NAME,THREADID,USERID</value></constructor-arg>
        <constructor-arg index="5"><value>HOST,NAME</value></constructor-arg>
        <constructor-arg index="6"><ref bean="DefaultThreadPool"/></constructor-arg>
        <constructor-arg index="7"><ref bean="EjbServer"/></constructor-arg>
    </bean>
    
    <bean name="EjbServer" class="org.openejb.server.ejbd.EjbServer">
        <constructor-arg index="0"><ref bean="ContainerIndex"/></constructor-arg>
        <constructor-arg index="1"><null/></constructor-arg>
    </bean>
    
    <bean name="ContainerIndex" class="org.openejb.ContainerIndex">
        <constructor-arg index="0">
            <bean class="org.gbean.geronimo.CollectionReference">
                <property name="name"><value>ResourceManagers</value></property>
                <property name="patterns">
                    <set>
                        <value type="javax.management.ObjectName">*:j2eeType=StatelessSessionBean,*</value>
                        <value type="javax.management.ObjectName">*:j2eeType=StatefulSessionBean,*</value>
                        <value type="javax.management.ObjectName">*:j2eeType=EntityBean,*</value>
                    </set>
                </property>
                <property name="type"><value>org.openejb.EJBContainer</value></property>
            </bean>
        </constructor-arg>
    </bean>

    <bean name="JMXService" class="org.apache.geronimo.jmxremoting.JMXConnector" depends-on="NamingProperties, RMIRegistry">
        <constructor-arg index="0"><bean class="org.gbean.geronimo.GeronimoKernelReference"/></constructor-arg>
        <constructor-arg index="1"><bean class="org.gbean.spring.ObjectNameStringReference"/></constructor-arg>
        <constructor-arg index="2"><bean class="org.gbean.spring.ClassLoaderReference"/></constructor-arg>
        <property name="url"><value>service:jmx:rmi://localhost/jndi/rmi:/JMXConnector</value></property>
        <property name="applicationConfigName"><value>JMX</value></property>
    </bean>

    <bean name="eis/JAXR" class="org.apache.geronimo.webservices.jaxr.JAXRGBean"/>

    <bean name="J2EEServer" class="org.apache.geronimo.j2ee.management.impl.J2EEServerImpl">
        <property name="gbean-objectName"><value>geronimo.server:j2eeType=J2EEServer,name=geronimo</value></property>
        <constructor-arg index="0"><bean class="org.gbean.geronimo.GeronimoKernelReference"/></constructor-arg>
        <constructor-arg index="1"><bean class="org.gbean.spring.ObjectNameStringReference"/></constructor-arg>
        <constructor-arg index="2"><ref bean="ServerInfo"/></constructor-arg>
    </bean>

    <bean name="MEJB" class="org.openejb.mejb.MEJB">
        <property name="gbean-objectName"><value>geronimo.server:J2EEApplication=null,EJBModule=org/apache/geronimo/Server,J2EEServer=geronimo,j2eeType=StatelessSessionBean,name=ejb/mgmt/MEJB</value></property>
        <constructor-arg index="0"><bean class="org.gbean.spring.ObjectNameStringReference"/></constructor-arg>
        <constructor-arg index="1"><bean class="org.gbean.geronimo.GeronimoKernelReference"/></constructor-arg>
    </bean>

</beans>

